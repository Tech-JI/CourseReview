# website/development.yaml

INSTALLED_APPS:
  - "django.contrib.admin"
  - "django.contrib.auth"
  - "django.contrib.contenttypes"
  - "django.contrib.sessions"
  - "django.contrib.messages"
  - "django.contrib.staticfiles"
  - "django.contrib.humanize"
  - "debug_toolbar"
  - "pipeline"
  - "crispy_forms"
  - "crispy_bootstrap4"
  - "django_celery_beat"
  - "django_celery_results"
  - "rest_framework"
  - "corsheaders"
  - "apps.analytics"
  - "apps.recommendations"
  - "apps.spider"
  - "apps.web"
  - "apps.auth"

MIDDLEWARE:
  - "corsheaders.middleware.CorsMiddleware"
  - "django.middleware.security.SecurityMiddleware"
  - "django.contrib.sessions.middleware.SessionMiddleware"
  - "django.middleware.common.CommonMiddleware"
  - "django.middleware.csrf.CsrfViewMiddleware"
  - "django.contrib.auth.middleware.AuthenticationMiddleware"
  - "django.contrib.messages.middleware.MessageMiddleware"
  - "django.middleware.clickjacking.XFrameOptionsMiddleware"
  - "debug_toolbar.middleware.DebugToolbarMiddleware"

ROOT_URLCONF: "website.urls"

TEMPLATES:
  - BACKEND: "django.template.backends.django.DjangoTemplates"
    DIRS: []
    APP_DIRS: True
    OPTIONS:
      context_processors:
        - "django.template.context_processors.debug"
        - "django.template.context_processors.request"
        - "django.contrib.auth.context_processors.auth"
        - "django.contrib.messages.context_processors.messages"

CRISPY_TEMPLATE_PACK: "bootstrap4"

WSGI_APPLICATION: "website.wsgi.application"

# Password validation
# https://docs.djangoproject.com/en/5.0/ref/settings/#auth-password-validators
AUTH_PASSWORD_VALIDATORS:
  - NAME: "django.contrib.auth.password_validation.UserAttributeSimilarityValidator"
  - NAME: "django.contrib.auth.password_validation.MinimumLengthValidator"
  - NAME: "django.contrib.auth.password_validation.CommonPasswordValidator"
  - NAME: "django.contrib.auth.password_validation.NumericPasswordValidator"

CELERY_RESULT_BACKEND: "django-db"
CELERY_TIMEZONE: "Asia/Shanghai"

AUTO_IMPORT_CRAWLED_DATA: "True"
# Internationalization
# https://docs.djangoproject.com/en/5.0/topics/i18n/
LANGUAGE_CODE: "en-us"
TIME_ZONE: "UTC"
USE_I18N: True
USE_TZ: True
# Static files (CSS, JavaScript, Images)
# https://docs.djangoproject.com/en/5.0/howto/static-files/
STATIC_ROOT: "staticfiles"
STATIC_URL: "/static/"
STATICFILES_STORAGE: "pipeline.storage.ManifestStaticFilesStorage"
STATICFILES_FINDERS:
  - "django.contrib.staticfiles.finders.FileSystemFinder"
  - "django.contrib.staticfiles.finders.AppDirectoriesFinder"
  - "pipeline.finders.PipelineFinder"

PIPELINE:
  JAVASCRIPT:
    app:
      source_filenames:
        - "js/plugins.js"
        - "js/vendor/jquery.highlight-5.js"
        - "js/web/base.jsx"
        - "js/web/common.jsx"
        - "js/web/landing.jsx"
        - "js/web/current_term.jsx"
        - "js/web/course_detail.jsx"
        - "js/web/course_review_search.jsx"
      output_filename: "js/app.js"
  STYLESHEETS:
    app:
      source_filenames:
        - "css/web/base.css"
        - "css/web/current_term.css"
        - "css/web/course_detail.css"
        - "css/web/course_review_search.css"
        - "css/web/landing.css"
        - "css/web/auth.css"
      output_filename: "css/app.css"
      extra_context:
        media: "screen,projection"

# Default primary key field type
# https://docs.djangoproject.com/en/5.0/ref/settings/#default-auto-field
DEFAULT_AUTO_FIELD: "django.db.models.BigAutoField"

SESSION_COOKIE_AGE: 2592000 # 30 days
SESSION_SAVE_EVERY_REQUEST: True
SESSION_ENGINE: "django.contrib.sessions.backends.cache"
SESSION_CACHE_ALIAS: "default"

ALLOWED_HOSTS:
  - "localhost"
  - "127.0.0.1"
  - "0.0.0.0"

# OAuth
AUTH:
  OTP_TIME_OUT: 120 # 2 min
  TEMP_TOKEN_TIMEOUT: 600 # 10 min
  ACTION_LIST:
    - "signup"
    - "login"
    - "reset_password"
  TOKEN_RATE_LIMIT: 5 # max 5 callback attempts per temp_token
  TOKEN_RATE_LIMIT_TIME: 600 # 10 minutes window
  PASSWORD_LENGTH_MIN: 10
  PASSWORD_LENGTH_MAX: 32
  QUEST_BASE_URL: "https://wj.sjtu.edu.cn/api/v1/public/export"
  EMAIL_DOMAIN_NAME: "sjtu.edu.cn"
